[
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Item", 
  "modified": "2016-12-28 14:02:48.357009", 
  "name": "Item-Client", 
  "script": "\nfrappe.ui.form.on(\"Sales Invoice\", {\n    get_calculation: function(frm) {\n        var dialog = new frappe.ui.Dialog({\n            title: __(\"Set as Lost\"),\n            fields: [{\n                \"fieldtype\": \"Link\",\n                \"label\": __(\"\u0623\u062e\u062a\u0631 \u0631\u0642\u0645 \u0627\u0644\u0642\u064a\u0627\u0633\"),\n                \"fieldname\": \"calc\",\n                \"reqd\": 1,\n                \"options\": \"calculation\"\n            }, {\n                \"fieldtype\": \"Button\",\n                \"label\": __(\"\u0627\u062e\u062a\u0631\"),\n                \"fieldname\": \"update\"\n            }, ]\n        });\n        dialog.fields_dict.update.$input.click(function() {\n            arg = dialog.fields_list[0].input.value;\n            if (!arg) return;\n            return frappe.call({\n                method: \"frappe.client.get\",\n                args: {\n                    \"doctype\": \"calculation\",\n                    \"name\": arg\n                },\n                callback: function(r) {\n                    var row_name =\"\";\n                    if (frm.doc.items[0].item_code === undefined) {\n                      row_name= \"New Sales Invoice Item 1\";\n                    }else {\n                      row = frappe.model.add_child(frm.doc, 'Sales Invoice Item', \"items\");\n                      row_name = row.name;\n                    }\n                        if (r.message.total_m_price || r.message.total_f_price) {\n                            frappe.model.set_value(\"Sales Invoice Item\", row_name, \"item_code\", \"\u0639\u0645\u0644 \u0628\u0631\u0648\u0627\u0632\");\n                            setTimeout(function() {\n                                frappe.model.set_value(\"Sales Invoice Item\", row_name, \"qty\", (r.message.quantity_f));\n                                frappe.model.set_value(\"Sales Invoice Item\", row_name, \"rate\", (r.message.total_m_price + r.message.total_f_price));\n                            }, 100);\n                        } else if (r.message.total_g_price) {\n                            frappe.model.set_value(\"Sales Invoice Item\", row_name, \"item_code\", \"\u0639\u0645\u0644 \u0632\u062c\u0627\u062c\");\n                            setTimeout(function() {\n                                frappe.model.set_value(\"Sales Invoice Item\", row_name, \"qty\", (r.message.quantity_g));\n                                frappe.model.set_value(\"Sales Invoice Item\", row_name, \"rate\", r.message.total_g_price);\n                            }, 100);\n                        } else if (r.message.type == \"\u0643\u0627\u0646\u0641\u0627\u0633\") {\n                            frappe.model.set_value(\"Sales Invoice Item\", row_name, \"item_code\", \"\u0639\u0645\u0644 \u0643\u0627\u0646\u0641\u0627\u0633\");\n                            setTimeout(function() {\n                                frappe.model.set_value(\"Sales Invoice Item\", row_name, \"qty\", (r.message.quantity_c));\n                                frappe.model.set_value(\"Sales Invoice Item\", row_name, \"rate\", r.message.price);\n                            }, 100);\n                        }\n                    dialog.hide();\n                },\n                btn: this\n            });\n        });\n        dialog.show();\n    }\n});\n", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Sales Invoice", 
  "modified": "2016-12-28 11:30:00.302189", 
  "name": "Sales Invoice-Client", 
  "script": "\nfrappe.ui.form.on(\"Sales Invoice\", {\n    get_calculation: function(frm) {\n        var dialog = new frappe.ui.Dialog({\n            title: __(\"Set as Lost\"),\n            fields: [{\n                \"fieldtype\": \"Link\",\n                \"label\": __(\"\u0623\u062e\u062a\u0631 \u0631\u0642\u0645 \u0627\u0644\u0642\u064a\u0627\u0633\"),\n                \"fieldname\": \"calcz\",\n                \"reqd\": 1,\n                \"options\": \"calculation\"\n            }, {\n                \"fieldtype\": \"Button\",\n                \"label\": __(\"\u0627\u062e\u062a\u0631\"),\n                \"fieldname\": \"update\"\n            }, ]\n        });\n        dialog.fields_dict.update.$input.click(function() {\n            arg = dialog.fields_list[0].input.value;\n            if (!arg) return;\n            return frappe.call({\n                method: \"frappe.client.get\",\n                args: {\n                    \"doctype\": \"calculation\",\n                    \"name\": arg\n                },\n                callback: function(r) {\n\n                    console.log(\"frm.doc.items[0].item_code\", frm.doc.items[0].item_code);\n                    var row_name =\"\";\n                    if (frm.doc.items[0].item_code === undefined) {\n                      row_name= \"New Sales Invoice Item 1\";\n                    }else {\n                      row = frappe.model.add_child(frm.doc, 'Sales Invoice Item', \"items\");\n                      row_name = row.name;\n                    }                      \n                        if (r.message.total_m_price || r.message.total_f_price) {\n                            frappe.model.set_value(\"Sales Invoice Item\", row_name, \"item_code\", \"\u0639\u0645\u0644 \u0628\u0631\u0648\u0627\u0632\");\n                            setTimeout(function() {\n                                frappe.model.set_value(\"Sales Invoice Item\", row_name, \"qty\", (r.message.quantity_f));\n                                frappe.model.set_value(\"Sales Invoice Item\", row_name, \"rate\", (r.message.total_m_price + r.message.total_f_price));\n                            }, 100);\n                        } else if (r.message.total_g_price) {\n                            console.log(\"ffffffff\");\n                            frappe.model.set_value(\"Sales Invoice Item\", row_name, \"item_code\", \"\u0639\u0645\u0644 \u0632\u062c\u0627\u062c\");\n                            setTimeout(function() {\n                                frappe.model.set_value(\"Sales Invoice Item\", row_name, \"qty\", (r.message.quantity_g));\n                                frappe.model.set_value(\"Sales Invoice Item\", row_name, \"rate\", r.message.total_g_price);\n                            }, 100);\n                        } else if (r.message.type == \"\u0643\u0627\u0646\u0641\u0627\u0633\") {\n                            console.log(\"bbbbbbb\");\n                            frappe.model.set_value(\"Sales Invoice Item\", row_name, \"item_code\", \"\u0639\u0645\u0644 \u0643\u0627\u0646\u0641\u0627\u0633\");\n                            setTimeout(function() {\n                                frappe.model.set_value(\"Sales Invoice Item\", row_name, \"qty\", (r.message.quantity_c));\n                                frappe.model.set_value(\"Sales Invoice Item\", row_name, \"rate\", r.message.price);\n                            }, 100);\n                        }                        \n                    dialog.hide();\n                    // cur_frm.refresh();\n                },\n                btn: this\n            })\n        });\n        dialog.show();\n    }\n});", 
  "script_type": "Client"
 }
]